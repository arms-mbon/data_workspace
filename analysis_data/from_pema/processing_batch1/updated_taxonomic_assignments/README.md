The taxonomic assignments from PEMA for COI and 18S from the batch 1 processing of the ARMS-MBON data have been curated by us to accommodate some issues:
*  Due to a bug in V2.1.4 of PEMA (subsequently fixed), the assignments in the **Extended_final_table_XX.xlsx files for COI** in the [taxonomic_assignments folder](https://github.com/arms-mbon/data_workspace/tree/main/analysis_data/from_pema/processing_batch1/taxonomic_assignments) are only denoted to the genus level. The species-level assignments can be found in the tax_assignments files that accompany those final tables. We have extracted those species-level assignments and inserted those, together with newly-minted species-level NBCI IDs, into new Extended_final_table_XX.csv files (note: CSV rather than XLSX). The code to do this and the new tables can be found here.
*  For the **Extended_final_table_XX.xlsx files for 18S**, the taxonomy returned from the PR2 database is not as straightforward to compare to taxonomies from other databases due to its unique organisation of taxon nodes used. In order to make more sensible use of these taxonomy results for our subsequent need to match the taxonomic assigments to WoRMS (World Register of Marine Species), we have undertaken a curation of the taxonomic classification for 18S. The code for doing this curation and the outputs from the curation can be found here: we have created new __Extended_final_table_XX_TaxonomyCurated.csv__ files (note: CSV rather than XLSX) that contain the new results in the final two columns;  and a comparison of the previous and new taxonomic classifications can be found in the files called __XXX_TaxonomyCompared.csv__ (e.g. April2021_18S_noBlank_TaxonomyCurated.csv) with the OTUID (col 1), the original classification (col 2), and the new classification broken into taxon levels (cols 3-12). It is up to the user to decide whether they wish to adopt these curations for their own work, or not. For the specific case of 18S taxonomy, strings assigned by the PR2 database were curated as follows:
   *  Separate taxonomy strings into separate columns by ";"
   *  Strings partially containing "var." will be entirely repalced by "var."
   *  Strings containing a space, "XX" or "sp." are set as NA (this step is missing a couple of cases where species assignments are actually present but are in such a cryptic format that no general code that worked on all other cases could also retrieve those ones. This happens for cases where genus and species are for example in the following format: Phascolopsis;Phascolopsis (strain);gouldii (Phascolopsis (strain)). The species part at the end is not recognized with the code above and we could not come up with a rule that fits takes care of all other cases as well as this one. We just had to accept this as trade-off. The taxonomy strings from the PR2 database are just too cryptic in some cases.). 
   *  Remove columns that now only contain NAs
   *  Paste all columns back together into one string ignoring NAs and using "_" as delimiter. This step gets rid of NAs within a taxonomy.
   *  Separate taxonomy strings back into separate columns by "_"
   *  Change lowercase "clade" strings to uppercase "Clade" strings
   *  Create a Species column combining species and genus level strings in one string. This is done by checking for strings which do not have a capital letter (i.e., species level names) and pasting them together with the string in the preceding column.
   *  Final taxonomy levels are then set as follows: "Domain","Supergroup","Division/Kingdom","Phylum/Class","Level_X","Level_XX","Level_XXX","Level_XXXX","Level_XXXXX","Species"
   *  Species level strings containing the "lienage" string are set as NA
   *  Some taxonomic levels above the species level may have a "var." string remaining. Check if this is the case and manually adjust species level taxonomy for those cases (i.e., set the species level string to "GenusXY_speciesXY_var._XY")
   *  Remove numeric characters and "-" in species level assignments
 

The code used to work on the 18S files is [FixPEMAtaxassigments_18S_taxonomist.py](https://github.com/arms-mbon/data_workspace/blob/main/analysis_data/from_pema/processing_batch1/updated_taxonomic_assignments/FixPEMAtaxassigments_18S_taxonomist.py), a python script which has comments and should be useable therefrom. Licence: [CC BY SA](https://creativecommons.org/licenses/by-sa/4.0/deed.en).    

